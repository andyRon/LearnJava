Java Web
----------

[ã€ç‹‚ç¥è¯´Javaã€‘JavaWebå…¥é—¨åˆ°å®æˆ˜](https://www.bilibili.com/video/BV12J411M7Sj)

JavaWebæ˜¯æŒ‡æ‰€æœ‰é€šè¿‡Javaè¯­è¨€ç¼–å†™å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ç¨‹åºæ€»ç§°ã€‚

## 1ã€åŸºæœ¬æ¦‚å¿µ

Webå¼€å‘

- webï¼Œç½‘é¡µ
- é™æ€web
  - htmlã€css
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¸ä¼šå‘ç”Ÿå˜åŒ–
- åŠ¨æ€web
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªäººåœ¨ä¸åŒæ—¶é—´ï¼Œä¸åŒçš„åœ°ç‚¹çœ‹åˆ°çš„ä¿¡æ¯å„ä¸ç›¸åŒ
  - æŠ€æœ¯æ ˆï¼šServlet/JSPï¼ŒASPï¼ŒPHP

åœ¨Javaä¸­ï¼ŒåŠ¨æ€webèµ„æºå¼€å‘çš„æŠ€æœ¯ç»Ÿç§°ä¸ºJava Webã€‚

### webåº”ç”¨ç¨‹åº

webåº”ç”¨ç¨‹åºï¼šå¯ä»¥æä¾›æµè§ˆå™¨è®¿é—®çš„ç¨‹åºã€‚



### é™æ€web

ç¼ºç‚¹ï¼š

- webä¸å¯ä»¥åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªé¡µé¢
- æ— æ³•å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æ— æ³•æŒä¹…åŒ–ï¼Œç”¨æˆ·æ— æ³•äº¤äº’ï¼‰



### åŠ¨æ€web

![](../../images/java-071.jpg)



æ–°æ‰‹æ‘ -> é­”é¬¼è®­ç»ƒï¼ˆåˆ†æåŸç†ï¼Œçœ‹æºç ï¼‰-> PKåœº

## 2ã€webæœåŠ¡å™¨

ASP

- å¾®è½¯ï¼Œå›½å†…æœ€æ—©æµè¡Œçš„
- åœ¨HTMLä¸­åµŒå…¥VBçš„è„šæœ¬
- ç»´æŠ¤æˆæœ¬é«˜
- C#
- IIS

PHP

JSP/Servletï¼š

- Sunå…¬å¸ä¸»æ¨çš„B/Sæ¶æ„ï¼ˆB/Sæµè§ˆå™¨å’ŒæœåŠ¡å™¨ï¼ŒC/Så®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰
- å¯ä»¥æ‰¿è½½ä¸‰é«˜ï¼ˆé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€é«˜æ€§èƒ½ï¼‰å¸¦æ¥çš„å½±å“

### webæœåŠ¡å™¨

æœåŠ¡å™¨æ˜¯ä¸€ç§è¢«åŠ¨çš„æ“ä½œï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„ä¸€äº›è¯·æ±‚å’Œç»™ç”¨æˆ·ä¸€äº›å“åº”ä¿¡æ¯ã€‚

**IIS**

**Tomcat**



## 3ã€Tomcat

[å®˜ç½‘](https://tomcat.apache.org/)

å®é™…ä¸ŠTomcatæ˜¯ApacheæœåŠ¡å™¨çš„æ‰©å±•ï¼Œä½†è¿è¡Œæ—¶å®ƒæ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œæ‰€ä»¥å½“ä½ è¿è¡Œtomcat æ—¶ï¼Œå®ƒå®é™…ä¸Šä½œä¸ºä¸€ä¸ªä¸Apache ç‹¬ç«‹çš„è¿›ç¨‹å•ç‹¬è¿è¡Œçš„ã€‚

å½“é…ç½®æ­£ç¡®æ—¶ï¼ŒApache ä¸ºHTMLé¡µé¢æœåŠ¡ï¼Œè€ŒTomcat å®é™…ä¸Šè¿è¡ŒJSP é¡µé¢å’ŒServletã€‚

Tomcatæœ¬èº«æ˜¯JAVAç¨‹åºã€‚



### å®‰è£…ã€å¯åŠ¨

ä¸‹è½½è§£å‹å³å¯ï¼Œè¯¦ç»†è§[Macä¸‹å®‰è£…TomcatåŠé…ç½®](https://www.jianshu.com/p/87121d912d10)ã€‚

å¯åŠ¨Tomcatï¼Œ`bin/startup.sh`

å…³é—­ï¼Œ`bin/shutdown.sh`

> æˆ‘Macä¸Šçš„åœ°å€ï¼š`~/java/Tomcat/apache-tomcat-9.0.30/bin`



é»˜è®¤è®¿é—®åœ°å€ http://localhost:8080/



å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š

- Javaç¯å¢ƒå˜é‡æ²¡æœ‰é…ç½®
- é—ªé€€é—®é¢˜ï¼šéœ€è¦é…ç½®å…¼å®¹æ€§
- ä¹±ç é—®é¢˜ï¼šé…ç½®æ–‡ä»¶ä¸­è®¾ç½®



### ç›®å½•ç»“æ„

- `bin/`     å¯æ‰§è¡Œç¨‹åº

- `conf/`   Tomcatçš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­server.xmlä¸ºæœåŠ¡å™¨çš„ä¸»é…ç½®æ–‡ä»¶ï¼›web.xmlä¸ºæ‰€æœ‰Webåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›tomcat-users.xmlç”¨äºå®šä¹‰Tomcaté…ç½®ç”¨æˆ·çš„æƒé™ä¸å®‰å…¨ã€‚

- `lib/`   å­˜æ”¾TomcatæœåŠ¡å™¨å’Œæ‰€æœ‰webåº”ç”¨éƒ½èƒ½è®¿é—®çš„**JARæ–‡ä»¶**ã€‚

- `logs/` 

- `temp`   ä¸´æ—¶æ•°æ®

- `work/`   Tomcatå·¥ä½œæ˜¯çš„ç›®å½•ï¼ŒTomcatè§£æJSPç”Ÿæˆçš„Servletæ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œsessioné’åŒ–çš„ç›®å½•ã€‚

- `webapps/`   å­˜æ”¾Webåº”ç”¨ç›¸å…³æ–‡ä»¶

- `webapps/ROOT`   é»˜è®¤çš„æœåŠ¡å™¨æ ¹ç›®å½•

### é…ç½®

 `conf/server.xml`æ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ ã€‚

ç«¯å£å·

```xml
<Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" />
```



ä¸»æœºåç§°

```xml
<Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
```

### å‘å¸ƒä¸€ä¸ªwebç½‘ç«™

å°†è‡ªå·±å†™çš„ç½‘ç«™ï¼Œæ”¾åˆ°æœåŠ¡å™¨ï¼ˆTomcatï¼‰ä¸­æŒ‡å®šçš„webåº”ç”¨çš„æ–‡ä»¶å¤¹ï¼ˆwebappsï¼‰ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®äº†ï¼ˆhttp://localhost:8080/andyron/ï¼‰ã€‚

`webapps`ä¸‹æ¯ä¸€ä¸ªç›®å½•å°±æ˜¯ä¸€ä¸ªwebå·¥ç¨‹ã€‚

ç½‘ç«™åº”è¯¥æœ‰çš„ç»“æ„ï¼š

```shell
--webapps
	-Root
	-andyron  		ç½‘ç«™çš„ç›®å½•å
		-WEB-INF
			-classes	javaç¨‹åº
			-lib			webåº”ç”¨æ‰€ä¾èµ–çš„jaråŒ…
			-web.xml	ç½‘ç«™é…ç½®æ–‡ä»¶
		-index.html
		-static
			-css
				-style.css
			-js
			-img
		-...
```



## 4ã€HTTP

### ä»€ä¹ˆæ˜¯HTTP



### ä¸¤ä¸ªæ—¶ä»£

- http1.0

  HTTP/1.0ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œåªèƒ½è·å¾—ä¸€ä¸ªwebèµ„æºï¼Œæ–­å¼€è¿æ¥

- Http2.0

  HTTP/1.1ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œå¯ä»¥è·å¾—å¤šä¸ªwebèµ„æº



## 5ã€Maven

[Mavenå®˜ç½‘](https://maven.apache.org/)

### ç®€ä»‹

> æˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ è¿™ä¸ªæŠ€æœ¯ï¼Ÿ

1. åœ¨Javawebå¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨å¤§é‡çš„jaråŒ…ï¼Œä¹‹å‰éœ€è¦æ‰‹åŠ¨å»å¯¼å…¥
2. å¦‚æœèƒ½å¤Ÿè®©ä¸€ä¸ªä¸œè¥¿è‡ªåŠ¨å¸®æˆ‘å¯¼å…¥å’Œé…ç½®è¿™äº›jaråŒ…ã€‚

ç”±æ­¤Mavenè¯ç”Ÿäº†ã€‚

Mavenæ˜¯Apacheä¸‹çš„ä¸€ä¸ªçº¯Javaå¼€å‘çš„ã€å¼€æºçš„é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹Javaé¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆç¼©å†™ï¼š**POM**ï¼‰æ¦‚å¿µï¼Œåˆ©ç”¨ä¸€ä¸ªä¸­å¤®ä¿¡æ¯ç‰‡æ–­èƒ½ç®¡ç†ä¸€ä¸ªé¡¹ç›®çš„æ„å»ºã€æŠ¥å‘Šå’Œæ–‡æ¡£ç­‰æ­¥éª¤ã€‚

#### MavenåŠŸèƒ½

æ„å»ºã€æ–‡æ¡£ç”Ÿæˆã€æŠ¥å‘Šã€ä¾èµ–ã€SCMsã€å‘å¸ƒã€åˆ†å‘ã€é‚®ä»¶åˆ—è¡¨

#### çº¦å®šé…ç½®

Mavençš„æ ¸å¿ƒæ€æƒ³ï¼š**çº¦å®šå¤§äºé…ç½®**ï¼ˆæœ‰çº¦æŸï¼Œä¸è¦å»è¿åï¼‰ã€‚ä¹Ÿå°±æ˜¯å…±åŒçš„æ ‡å‡†ç›®å½•ç»“æ„ï¼š

| ç›®å½•                               | ç›®çš„                                                         |
| :--------------------------------- | :----------------------------------------------------------- |
| ${basedir}                         | å­˜æ”¾pom.xmlå’Œæ‰€æœ‰çš„å­ç›®å½•                                    |
| ${basedir}/src/main/java           | é¡¹ç›®çš„javaæºä»£ç                                              |
| ${basedir}/src/main/resources      | é¡¹ç›®çš„èµ„æºï¼Œæ¯”å¦‚è¯´propertyæ–‡ä»¶ï¼Œspringmvc.xml                |
| ${basedir}/src/test/java           | é¡¹ç›®çš„æµ‹è¯•ç±»ï¼Œæ¯”å¦‚è¯´Junitä»£ç                                 |
| ${basedir}/src/test/resources      | æµ‹è¯•ç”¨çš„èµ„æº                                                 |
| ${basedir}/src/main/webapp/WEB-INF | webåº”ç”¨æ–‡ä»¶ç›®å½•ï¼Œwebé¡¹ç›®çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å­˜æ”¾web.xmlã€æœ¬åœ°å›¾ç‰‡ã€jspè§†å›¾é¡µé¢ |
| ${basedir}/target                  | æ‰“åŒ…è¾“å‡ºç›®å½•                                                 |
| ${basedir}/target/classes          | ç¼–è¯‘è¾“å‡ºç›®å½•                                                 |
| ${basedir}/target/test-classes     | æµ‹è¯•ç¼–è¯‘è¾“å‡ºç›®å½•                                             |
| Test.java                          | Mavenåªä¼šè‡ªåŠ¨è¿è¡Œç¬¦åˆè¯¥å‘½åè§„åˆ™çš„æµ‹è¯•ç±»                      |
| ~/.m2/repository                   | Mavené»˜è®¤çš„æœ¬åœ°ä»“åº“ç›®å½•ä½ç½®                                  |

#### 



### ä¸‹è½½å®‰è£…Maven



ä¸‹è½½è§£å‹å³å¯ã€‚Macä¸­çš„ä½ç½®`/usr/local/apache-maven-3.6.3`

> å»ºè®®ç”µè„‘ä¸Šæ‰€æœ‰ç¯å¢ƒéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚

#### ç›®å½•ç»“æ„

```shell
-bin
-boot
-conf
	-settings.xml
-lib
```

è®¾ç½®Mavenç¯å¢ƒå˜é‡`MAVEN_HOME`ä¸º`/usr/local/apache-maven-3.6.3`ã€‚

### é˜¿é‡Œäº‘é•œåƒ



### æœ¬åœ°ä»“åº“



```xml
  <!-- localRepository
   | The paÂ·th to the local repository maven will use to store artifacts.
   |
   | Default: ${user.home}/.m2/repository
  <localRepository>/path/to/local/repo</localRepository>
  -->

```



### 5.6 åœ¨IDEAä¸­ä½¿ç”¨Maven

1. å¯åŠ¨IDEA
2. åˆ›ä¸€ä¸ªMaven webé¡¹ç›®ï¼ˆé€šè¿‡mavençš„æ¨¡æ¿ï¼Œarchetypeï¼‰

![](../../images/java-072.jpg)

å¯ä»¥é€‰æ‹©æ–°çš„ä»“åº“

archetype ä¹Ÿå°±æ˜¯åŸå‹ï¼Œæ˜¯ä¸€ä¸ª Maven æ’ä»¶ï¼Œå‡†ç¡®è¯´æ˜¯ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯æ ¹æ®æ¨¡æ¿åˆ›å»ºä¸€ä¸ªé¡¹ç›®ç»“æ„ã€‚





3. ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæ¯•

   

4. è§‚å¯ŸMavenä»“åº“ä¸­å¤šäº†ä»€ä¹ˆ



5. IDEAä¸­çš„Mavenè®¾ç½®

![](../../images/java-073.jpg)



### 5.7 Mavenåˆ›å»ºä¸€ä¸ªæ™®é€šé¡¹ç›®

ä¸å‹¾é€‰archetype

![](../../images/java-074.jpg)

### 5.8 æ ‡è®°æ–‡ä»¶å¤¹åŠŸèƒ½

![](../../images/java-075.jpg)

ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ç»“æ„é…ç½®ï¼ˆProject Structureï¼Œ`#+;`ï¼‰ä¸­é…ç½®ã€‚

### 5.9 åœ¨ideaä¸­é…ç½®Tomcat

![](../../images/java-076.jpg)

ç‚¹å‡»+å·ï¼ŒTomcat Server -> local

### 5.10 pomæ–‡ä»¶

pom.xmlæ˜¯Mavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚

POM( Project Object Modelï¼Œé¡¹ç›®å¯¹è±¡æ¨¡å‹ ) æ˜¯ Maven å·¥ç¨‹çš„åŸºæœ¬å·¥ä½œå•å…ƒï¼Œæ˜¯ä¸€ä¸ªXMLæ–‡ä»¶ï¼ŒåŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œç”¨äºæè¿°é¡¹ç›®å¦‚ä½•æ„å»ºï¼Œå£°æ˜é¡¹ç›®ä¾èµ–ï¼Œç­‰ç­‰ã€‚

æ‰€æœ‰ POM æ–‡ä»¶éƒ½éœ€è¦ project å…ƒç´ å’Œä¸‰ä¸ªå¿…éœ€å­—æ®µï¼šgroupIdï¼ŒartifactIdï¼Œversionã€‚

![](../../images/java-077.jpg)



```xml
<?xml version="1.0" encoding="UTF-8"?>

<!-- Mavenç‰ˆæœ¬å’Œå¤´æ–‡ä»¶ -->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.andyron</groupId>
  <artifactId>javaweb-01-maven</artifactId>
  <version>1.0-SNAPSHOT</version>

  <!-- é¡¹ç›®çš„æ‰“åŒ…æ–¹å¼
  jarï¼šJavaåº”ç”¨
  warï¼šJavaWebåº”ç”¨
  -->
  <packaging>war</packaging>

  <!-- é…ç½® -->
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.7</maven.compiler.source>
    <maven.compiler.target>1.7</maven.compiler.target>
  </properties>

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <!-- é¡¹ç›®æ„å»ºç”¨çš„ä¸œè¥¿-->
  <build>
  ....
  </build>
</project>
```

mavençº¦å®šå¤§äºé…ç½®ã€‚

æ— æ³•å¯¼å‡ºçš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ï¼š

```xml
    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <includes>
                    <include>**/*.properties</include>
                    <include>**/*.xml</include>
                </includes>
                <filtering>true</filtering>
            </resource>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.properties</include>
                    <include>**/*.xml</include>
                </includes>
                <filtering>true</filtering>
            </resource>
        </resources>
    </build>
```

### é‡åˆ°çš„é—®é¢˜



## 6ã€Servlet

### 6.1 ç®€ä»‹

- Servletå°±æ˜¯sunå…¬å¸å¼€å‘åŠ¨æ€webçš„ä¸€é—¨æŠ€æœ¯

- sunåœ¨è¿™äº›APIä¸­æä¾›ä¸€ä¸ªå€Ÿå£å«åšï¼šServletï¼Œå¦‚æœæƒ³å¼€å‘ä¸€ä¸ªServletç¨‹åºï¼Œåªéœ€è¦å®Œæˆä¸¤ä¸ªå°æ­¥éª¤ï¼š
  - ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£
  - æŠŠå¼€å‘å¥½çš„Javaç±»éƒ¨ç½²åˆ°WebæœåŠ¡å™¨ä¸­

æŠŠå®ç°äº†Servletæ¥å£çš„Javaç¨‹åºå«åš**Servlet**ã€‚



### 6.2 HelloServlet

Sunæä¾›äº†ä¸¤ä¸ªServletå®ç°ç±»ï¼š`HttpServlet`, `GenericServlet`

1. æ„å»ºæ™®é€šçš„mavené¡¹ç›®ï¼Œåˆ é™¤srcç›®å½•ï¼Œå¾—åˆ°ä¸»å·¥ç¨‹
2. å…³äºMavençˆ¶å­å·¥ç¨‹çš„ç†è§£

3. Mavenç¯å¢ƒä¼˜åŒ–:

   - ä¿®æ”¹web.xmlä¸ºæœ€æ–°çš„

     ```xml
     <?xml version="1.0" encoding="utf-8" ?>
     <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                                 http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
              version="4.0"
              metadata-complete="true">
       
     </web-app>
     ```

     

   - å°†mavençš„ç»“æ„å¡”å°–å®Œæ•´

4. ç¼–å†™ä¸€ä¸ªServletç¨‹åº
   - ç¼–å†™ä¸€ä¸ªæ™®é€šç±»
   - å®ç°Servletæ¥å£ï¼Œè¿™é‡Œç›´æ¥ç»§æ‰¿HttpServlet

5. ç¼–å†™Servletçš„æ˜ å°„

ä¸ºä»€ä¹ˆéœ€è¦æ˜ å°„ï¼šæˆ‘ä»¬å†™çš„æ˜¯Javaç¨‹åºï¼Œä½†æ˜¯è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè€Œæµè§ˆå™¨éœ€è¦è¿æ¥webæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨webæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬å†™çš„Servletï¼Œè¿˜éœ€ç»™å®ƒä¸€ä¸ªæµè§ˆå™¨èƒ½å¤Ÿè®¿é—®çš„è·¯å¾„ï¼š

```xml
<!-- æ³¨å†ŒServlet -->
  <servlet>
    <servlet-name>hello</servlet-name>
    <servlet-class>com.andyron.servlet.HelloServlet</servlet-class>
  </servlet>
  <!-- Servletçš„è¯·æ±‚è·¯å¾„ -->
  <servlet-mapping>
    <servlet-name>hello</servlet-name>
    <url-pattern>/hello</url-pattern>
  </servlet-mapping>
```

> æ³¨æ„url-patternä¸­`/`

6. é…ç½®Tomcat

é…ç½®é¡¹ç›®å‘å¸ƒçš„è·¯å¾„

![](../../images/java-078.jpg)

7. å¯åŠ¨æµ‹è¯•

### 6.3 ServletåŸç†

Servletæ˜¯ç”±WebæœåŠ¡å™¨è°ƒç”¨ï¼ŒwebæœåŠ¡å™¨åœ¨å—åˆ°æµè§ˆå™¨è¯·æ±‚ä¹‹åï¼Œä¼šï¼š

![](../../images/java-079.jpg)



### 6.4 Mappingé—®é¢˜

1. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello</url-pattern>
   </servlet-mapping>
   ```

   

2. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello</url-pattern>
   </servlet-mapping>
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello2</url-pattern>
   </servlet-mapping>
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello3</url-pattern>
   </servlet-mapping>
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello4</url-pattern>
   </servlet-mapping>
   ```

   

3. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šé€šç”¨æ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/hello/*</url-pattern>
   </servlet-mapping>
   ```

4. é»˜è®¤è¯·æ±‚è·¯å¾„

   ```xml
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>/*</url-pattern>
   </servlet-mapping>
   ```

   

5. æŒ‡å®šä¸€äº›åç¼€æˆ–å‰ç¼€ç­‰ç­‰...

   ```xml
   <!-- å¯ä»¥è‡ªå®šä¹‰åç¼€å®ç°è¯·æ±‚æ˜ å°„
       æ³¨æ„ç‚¹ï¼š*å‰é¢ä¸èƒ½åŠ é¡¹ç›®æ˜ å°„çš„è·¯å¾„
       -->
   <servlet-mapping>
     <servlet-name>hello</servlet-name>
     <url-pattern>*.andy</url-pattern>
   </servlet-mapping>
   ```

   

6. ä¼˜å…ˆçº§é—®é¢˜

   æŒ‡å®šäº†å›ºæœ‰çš„æ˜ å°„è·¯å¾„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šèµ°é»˜è®¤çš„å¤„ç†è¯·æ±‚

### 6.5 ServletContext

> æ³¨æ„ï¼šé…ç½®Tomcatï¼ŒwaråŒ…æ—¶ï¼Œå»é™¤å…¶å®ƒé¡¹ç›®çš„warï¼Œå¦è€…ä¼šè¢«ä¸€èµ·æ‰“åŒ…ï¼Œå½±å“é€Ÿåº¦ã€‚

webå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªwebç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextå¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†å½“å‰çš„webåº”ç”¨ï¼›

#### å…±äº«æ•°æ®

åœ¨ä¸€ä¸ªServletä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¯ä»¥å’‹å¦ä¸€ä¸ªServletä¸­æ‹¿åˆ°

![](../../images/java-080.jpg)

```java
public class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        ServletContext context = this.getServletContext();
        String username = "Andy Ron";
        context.setAttribute("username", username); // å°†ä¸€ä¸ªæ•°æ®ä¿å­˜åœ¨ServletContextä¸­
    }
}

public class GetServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext context = this.getServletContext();
        String username = (String)context.getAttribute("username");

        resp.setContentType("text/html");
        resp.setCharacterEncoding("utf-8");
        resp.getWriter().print("åå­—ï¼š" + username);
    }
}
```

```xml
<servlet>
  <servlet-name>hello</servlet-name>
  <servlet-class>com.andyron.servlet.HelloServlet</servlet-class>
</servlet>
<servlet-mapping>
  <servlet-name>hello</servlet-name>
  <url-pattern>/hello</url-pattern>
</servlet-mapping>

<servlet>
  <servlet-name>getc</servlet-name>
  <servlet-class>com.andyron.servlet.GetServlet</servlet-class>
</servlet>
<servlet-mapping>
  <servlet-name>getc</servlet-name>
  <url-pattern>/getc</url-pattern>
</servlet-mapping>
```



#### è·å–åˆå§‹åŒ–å‚æ•°

web.xmlä¸­ï¼š

```xml
<!-- é…ç½®ä¸€äº›webåº”ç”¨åˆå§‹åŒ–å‚æ•° -->
<context-param>
  <param-name>url</param-name>
  <param-value>jdbc:mysql://localhost:3306/mybatis</param-value>
</context-param>
```

```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
  ServletContext context = this.getServletContext();

  String url = context.getInitParameter("url");
  resp.getWriter().print(url);
}
```



#### è¯·æ±‚è½¬å‘

```java
public class ServletDemo4 extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    System.out.println("in demo4");
    ServletContext context = this.getServletContext();    context.getRequestDispatcher("/demo3").forward(req, resp);
  }
}
```



> è¯·æ±‚è½¬å‘ä¸é‡å®šå‘æ˜¯ä¸åŒçš„ï¼Œå‰è€…è¯·æ±‚åœ°å€æ˜¯ä¸å˜ï¼Œåè€…å°±ç›´æ¥è®¿é—®å¦å¤–ä¸€ä¸ªåœ°å€ã€‚

#### è¯»å–èµ„æºæ–‡ä»¶

`Properties`

> åœ¨javaç›®å½•ä¸‹æ–°å»ºpropertiesæ–‡ä»¶ï¼›
>
> åœ¨resourcesç›®å½•ä¸‹æ–°å»ºpropertiesæ–‡ä»¶ï¼›
>
> å‘ç°éƒ½è¢«æ‰“åŒ…åˆ°åŒä¸€è·¯å¾„ä¸‹ï¼š`classes`ï¼Œä¿—ç§°è¿™ä¸ªè·¯å¾„ä¸ºclasspathï¼›
>
> æ€è·¯ï¼šéœ€è¦ä¸€ä¸ªæ–‡ä»¶æµ

```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
  ServletContext context = this.getServletContext();

  InputStream is = context.getResourceAsStream("/WEB-INF/classes/db.properties");
  Properties properties = new Properties();
  properties.load(is);
  String username = properties.getProperty("username");
  String password = properties.getProperty("password");
  resp.getWriter().print(username + ":" + password);

    }
```

![](../../images/java-081.jpg)

> æ³¨ï¼šServletContextä¸Šé¢ä»‹ç»çš„åŠŸèƒ½ä¹‹åå¾ˆå°‘ä½¿ç”¨ï¼Œéƒ½ä¼šè¢«å…¶å®ƒæ›¿ä»£ã€‚



### 6.6 HttpServletResponse

webæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯·æ±‚çš„HttpServletRequestå¯¹è±¡å’Œä¸€ä¸ªä»£è¡¨å“åº”çš„HttpServletResponseå¯¹è±¡ï¼›

#### ç®€å•åˆ†ç±»

è´Ÿè´£æƒ³æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•ï¼š

```java
public ServletOutputStream getOutputStream() throws IOException;

public PrintWriter getWriter() throws IOException;
```

è´Ÿè´£æƒ³æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•ï¼š

```java


```

å“åº”çš„çŠ¶æ€ç å¸¸é‡ï¼š

```java

```

#### ä¸‹è½½æ–‡ä»¶



1. è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
2. ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ
3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿
4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
5. åˆ›å»ºç¼“å†²åŒº
6. è·å–OutputStreamå¯¹è±¡
7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒºï¼Œä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ï¼



#### éªŒè¯ç åŠŸèƒ½

éªŒè¯ç æ€ä¹ˆæ¥çš„ï¼Ÿ

- å‰ç«¯å®ç°
- åç«¯å®ç°ï¼Œéœ€è¦åˆ°Javaçš„å›¾ç‰‡ç±»

#### å®ç°é‡å®šå‘

![](../../images/java-082.jpg)

ä¸€ä¸ªwebèµ„æºBå—åˆ°å®¢æˆ·ç«¯Aè¯·æ±‚åï¼Œå®ƒä¼šé€šçŸ¥å®¢æˆ·ç«¯Aå»è®¿é—®å¦ä¸€ä¸ªwebèµ„æºCï¼Œè¿™ä¸ªè¿‡ç¨‹å«é‡å®šå‘ã€‚

å¸¸è§åœºæ™¯ï¼š

- ç”¨æˆ·ç™»å½•

```java
public void sendRedirect(String location) throws IOException;
```

```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {


  resp.sendRedirect("/response_war/img");

  // ç­‰ä»·äº
  //        resp.setHeader("Location", "/response_war/img");
  //        resp.setStatus(302);

}
```

> é‡å®šå‘å’Œè½¬å‘ï¼Ÿ
>
> é¡µé¢éƒ½ä¼šå®ç°è·³è½¬
>
> å‰è€…åœ°å€æ ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåè€…ä¸ä¼šã€‚





### 6.7 HttpServletRequest

ç”¨æˆ·é€šè¿‡HTTPåè®®è®¿é—®æœåŠ¡å™¨ï¼ŒHTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestä¸­ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥åçš„å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ã€‚

#### è·å–å‰ç«¯ä¼ é€’çš„å‚æ•°

```java
String getParameter(String s);

String[] getParameterValues(String s);
```



ğŸ”–p15







## 7ã€Cookieã€Session

### 7.1 ä¼šè¯

**ä¼šè¯**ï¼šç”¨æˆ·æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»äº†å¾ˆå¤šè¶…é“¾æ¥ï¼Œè®¿é—®å¤šä¸ªwebèµ„æºï¼Œå…³é—­æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç§°ä¹‹ä¸ºä¼šè¯ï¼›

**æœ‰çŠ¶æ€ä¼šè¯**ï¼šä¸€ä¸ªåŒå­¦æ¥è¿‡æ•™å®¤ï¼Œä¸‹æ¬¡å†æ¥æ•™å®¤ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“è¿™ä¸ªåŒå­¦ï¼Œæ›¾ç»æ¥è¿‡ï¼Œç§°ä¹‹ä¸ºæœ‰çŠ¶æ€ä¼šè¯ï¼›
ä½ èƒ½æ€ä¹ˆè¯æ˜ä½ æ˜¯è¥¿å¼€çš„å­¦ç”Ÿï¼Ÿ
ä½ 		è¥¿å¼€
1.å‘ç¥¨	è¥¿å¼€ç»™ä½ å‘ç¥¨
2.å­¦æ ¡ç™»è®°	è¥¿å¼€æ ‡è®°ä½ æ¥è¿‡äº†

**ä¸€ä¸ªç½‘ç«™ï¼Œæ€ä¹ˆè¯æ˜ä½ æ¥è¿‡ï¼Ÿ**

å®¢æˆ·ç«¯
æœåŠ¡ç«¯
1.æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯ä¸€ä¸ªä¿¡ä»¶ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è®¿é—®æœåŠ¡ç«¯å¸¦ä¸Šä¿¡ä»¶å°±å¯ä»¥äº†ï¼›cookie 

2.æœåŠ¡å™¨ç™»è®°ä½ æ¥è¿‡äº†ï¼Œä¸‹æ¬¡ä½ æ¥çš„æ—¶å€™æˆ‘æ¥åŒ¹é…ä½ ï¼›seesion

### 7.2 ä¿å­˜ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯

cookieï¼šå®¢æœç«¯æŠ€æœ¯ï¼ˆå“åº”ï¼Œè¯·æ±‚ï¼‰

sessionï¼šæœåŠ¡å™¨æŠ€æœ¯ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯



å¸¸ç”¨åœºæ™¯ï¼šç½‘ç«™ç™»å½•ä¹‹åä¸è¦åœ¨ç™»å½•

ğŸ”–16:36

## 8ã€JSP





## 9ã€JavaBean

å®ä½“ç±»

JavaBeanæœ‰ç‰¹å®šçš„å†™æ³•ï¼š

- å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ 
- å±æ€§å¿…é¡»ç§æœ‰åŒ–
- å¿…é¡»æœ‰å¯¹åº”çš„get/setæ–¹æ³•

ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“çš„å­—æ®µåšæ˜ å°„ORMï¼›

ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„

- è¡¨ -> ç±»
- å­—æ®µ -> å±æ€§
- è¡Œè®°å½• -> å¯¹è±¡



## è¿‡æ»¤å™¨å’Œç›‘å¬å™¨

ç›‘å¬å™¨åœ¨Javawebå¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨



## JDBC

Java Database Connectivity

éœ€è¦jaråŒ…çš„æ”¯æŒï¼š



**æ•°æ®åº“**

```sql
create table users(
	id Int primary key,
  `name` varchar(40),
  `password` varchar(40),
  `email` varchar(60),
   birthday date
);

Insert into users(id, `name`, `password`,email, birthday)
values(1, 'å¼ ä¸‰', '123456','zs@163.com','2000-01-01');
Insert into users(id, `name`, `password`,email, birthday)
values(2, 'æå››', '123456','ls@163.com','2001-01-01');
Insert into users(id, `name`, `password`,email, birthday)
values(3, 'ç‹äº”', '123456','ww@163.com','2002-01-01');
```

å¯¼å…¥ä¾èµ–

```xml
<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-java</artifactId>
  <version>8.0.21</version>
</dependency>
```

**JDBCå›ºå®šå…­æ­¥éª¤**ï¼š

1. åŠ è½½é©±åŠ¨
2. é“¾æ¥æ•°æ®åº“
3.  å¾—åˆ°æƒ³æ•°æ®åº“å‘é€SQLçš„å¯¹è±¡ï¼šStatement
4. ç¼–å†™SQL
5. æ‰§è¡ŒSQL
6. å…³é—­è¿æ¥

```java
String url = "jdbc:mysql://localhost:3306/jdbc?useUnicode=true&characterEncoding=utf-8";
String username = "root";
String password = "iop654321";

// 1 åŠ è½½é©±åŠ¨
Class.forName("com.mysql.cj.jdbc.Driver");
// 2 é“¾æ¥æ•°æ®åº“ï¼Œconnectionç›¸å½“äºä»£è¡¨æ•°æ®åº“
Connection connection = DriverManager.getConnection(url, username, password);
// 3 å‘æ•°æ®åº“å‘é€SQLçš„å¯¹è±¡Statementæˆ–PreparedStatementï¼ˆå®‰å…¨çš„ï¼Œé¢„ç¼–è¯‘ï¼‰ï¼Œç”¨å®ƒæ¥åšcrud
Statement statement = connection.createStatement();
// 4 ç¼–å†™SQL
String sql = "select * from users";
// 5 æ‰§è¡ŒæŸ¥è¯¢SQLï¼Œè¿”å›ä¸€ä¸ªResultSetï¼šç»“æœé›†
ResultSet rs = statement.executeQuery(sql);
while (rs.next()) {
  System.out.println("id=" + rs.getObject("id"));
  System.out.println("name=" + rs.getObject("name"));
  System.out.println("password=" + rs.getObject("password"));
  System.out.println("email=" + rs.getObject("email"));
  System.out.println("birthday=" + rs.getObject("birthday"));
// 6 å…³é—­é“¾æ¥ï¼Œé‡Šæ”¾èµ„æºï¼ˆä¸€ç‚¹è¦åšï¼‰ã€‚å…ˆå¼€çš„åå…³é—­
rs.close();
statement.close();
connection.close();
```

é¢„ç¼–è¯‘SQLï¼š

```java
String url = "jdbc:mysql://localhost:3306/jdbc?useUnicode=true&characterEncoding=utf-8";
String username = "root";
String password = "iop654321";

// 1 åŠ è½½é©±åŠ¨
Class.forName("com.mysql.cj.jdbc.Driver");
// 2 é“¾æ¥æ•°æ®åº“ï¼Œconnectionç›¸å½“äºä»£è¡¨æ•°æ®åº“
Connection connection = DriverManager.getConnection(url, username, password);

// 3 ç¼–å†™SQL
String sql = "insert into users(id, name, password, email, birthday) VALUES (?,?,?,?,?)";

// 4 é¢„ç¼–è¯‘
PreparedStatement preparedStatement = connection.prepareStatement(sql);
preparedStatement.setInt(1,4);  // ç»™ç¬¬ä¸€ä¸ªå ä½ç¬¦ï¼Ÿèµ‹å€¼
preparedStatement.setString(2, "ç‹éº»å­");
preparedStatement.setString(3, "wmz12345");
preparedStatement.setString(4, "wmz@163.com");
preparedStatement.setDate(5, new Date(new java.util.Date().getTime()));

// 5 æ‰§è¡ŒSQL
int i = preparedStatement.executeUpdate();
if (i>0) {
  System.out.println("æ’å…¥æˆåŠŸ");
}
// 6 å…³é—­é“¾æ¥ï¼Œé‡Šæ”¾èµ„æºï¼ˆä¸€ç‚¹è¦åšï¼‰ã€‚å…ˆå¼€çš„åå…³é—­
preparedStatement.close();
connection.close();
```

**äº‹åŠ¡**

è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚

ACIDåŸåˆ™ï¼šä¿è¯æ•°æ®çš„å®‰å…¨ã€‚

> å¼€å¯äº‹åŠ¡
> äº‹åŠ¡æäº¤ commit()
> äº‹åŠ¡å›æ»š rollback()
> å…³é—­äº‹åŠ¡

äº‹åŠ¡ä¸€æ—¦æäº¤å°±æ²¡æ³•å›æ»šäº†ã€‚

```sql
create table account(
	id int primary key auto_increment,
  `name` varchar(40),
   money float
);
insert into account(name, money) VALUE('A', 1000);
insert into account(name, money) VALUE('B', 1000);
insert into account(name, money) VALUE('C', 1000);
```

```sql
start transaction ; #å¼€å¯äº‹åŠ¡

update account set money = money - 100 where name = 'A';
update account set money = money + 100 where name = 'B';

rollback ;
commit ;
```

```java
String url = "jdbc:mysql://localhost:3306/jdbc?useUnicode=true&characterEncoding=utf-8";
String username = "root";
String password = "iop654321";

Connection connection = null;

try {
  // 1 åŠ è½½é©±åŠ¨
  Class.forName("com.mysql.cj.jdbc.Driver");
  // 2 é“¾æ¥æ•°æ®åº“ï¼Œconnectionç›¸å½“äºä»£è¡¨æ•°æ®åº“
  connection = DriverManager.getConnection(url, username, password);

  // 3 é€šçŸ¥æ•°æ®åº“å¼€å¯äº‹åŠ¡ï¼Œfalseè¡¨ç¤ºå¼€å¯
  connection.setAutoCommit(false);

  String sql1 = "update account set money = money - 100 where name = 'A'";
  connection.prepareStatement(sql1).executeUpdate();

  // åˆ¶é€ é”™è¯¯
  int i = 1/0;

  String sql2 = "update account set money = money + 100 where name = 'B'";
  connection.prepareStatement(sql2).executeUpdate();

  connection.commit(); // ä¸¤æ¡SQLéƒ½æäº¤æˆåŠŸï¼Œå°±æäº¤äº‹åŠ¡
  System.out.println("success");

} catch (Exception e) {
  // å¦‚æœå‡ºç°å¼‚å¸¸é€šçŸ¥æ•°æ®åº“å›æ»šäº‹åŠ¡
  try {
    connection.rollback();
    System.out.println("rollback");
  } catch (SQLException ex) {
    ex.printStackTrace();
  }
} finally {
  try {
    connection.close();
  } catch (SQLException e) {
    e.printStackTrace();
  }
}
```



