ã€ŠJavaå®æˆ˜ã€‹ç¬¬äºŒç‰ˆæœ¬
---

https://livebook.manning.com/book/modern-java-in-action/about-this-book/



# ä¸€ã€åŸºç¡€çŸ¥è¯†

## 1 Java 8ã€9ã€10ä»¥åŠ11çš„å˜åŒ–

### 1.1 ä¸ºä»€ä¹ˆè¦å…³å¿ƒJavaçš„å˜åŒ–

Java 8æ‰€åšçš„æ”¹å˜ï¼Œå…¶å½±å“æ¯”Javaå†å²ä¸Šä»»ä½•ä¸€æ¬¡æ”¹å˜éƒ½æ·±è¿œæ¬¡æ”¹å˜éƒ½æ·±è¿œï¼ˆJava 9æ–°å¢äº†æ•ˆç‡æå‡æ–¹é¢çš„é‡è¦æ”¹è¿›ï¼Œä½†å¹¶ä¸ä¼¤ç­‹åŠ¨éª¨ã€‚Java 10å¯¹ç±»å‹æ¨æ–­åšäº†å¾®è°ƒï¼‰ã€‚

```java
// æŒ‰ç…§é‡é‡ç»™inventoryä¸­çš„è‹¹æœæ’åº
Collections.sort(inventory, new Comparator<Apple>() {
  public int compare(Apple a1, Apple a2){
    return a1.getWeight().compareTo(a2.getWeight());
  }
});
```



åŸºäºä¹‹å‰çš„ä¸¤ä¸ªè¿«åˆ‡éœ€æ±‚ï¼ˆå³ç¼–å†™æ›´ç®€æ´çš„ä»£ç ï¼Œä»¥åŠæ›´æ–¹ä¾¿åœ°åˆ©ç”¨å¤„ç†å™¨çš„å¤šæ ¸ï¼‰å‚¬ç”Ÿå‡ºäº†ä¸€åº§æ‹”åœ°è€Œèµ·ç›¸äº’å‹¾è¿ä¸€è‡´çš„Java 8å¤§å¦ã€‚

- Stream APIï¼›
- å‘æ–¹æ³•ä¼ é€’ä»£ç çš„æŠ€å·§ï¼›
- æ¥å£çš„é»˜è®¤æ–¹æ³•ã€‚

æµæ”¯æŒ==å¤šä¸ªæ•°æ®å¤„ç†çš„å¹¶è¡Œæ“ä½œ==ï¼Œå…¶æ€è·¯å’Œ**æ•°æ®åº“æŸ¥è¯¢è¯­è¨€**ç±»ä¼¼â€”â€”ä»é«˜å±‚çš„è§’åº¦æè¿°éœ€æ±‚ï¼Œè€Œç”±â€œå®ç°â€ï¼ˆè¿™é‡Œæ˜¯Streamåº“ï¼‰æ¥é€‰æ‹©åº•å±‚æœ€ä½³æ‰§è¡Œæœºåˆ¶ã€‚è¿™æ ·å°±å¯ä»¥é¿å…ç”¨`synchronized`ç¼–å†™ä»£ç ï¼Œè¿™ç§ä»£ç ä¸ä»…å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”åœ¨å¤šæ ¸CPUä¸Šæ‰§è¡Œæ‰€éœ€çš„æˆæœ¬ä¹Ÿæ¯”ä½ æƒ³è±¡çš„è¦é«˜ã€‚

åœ¨Java 8ä¸­åŠ å…¥Streamå¯ä»¥è§†ä¸ºæ·»åŠ å¦å¤–ä¸¤é¡¹çš„ç›´æ¥åŸå› ï¼šå‘æ–¹æ³•ä¼ é€’ä»£ç çš„ç®€æ´æŠ€å·§ï¼ˆæ–¹æ³•å¼•ç”¨ã€Lambdaï¼‰å’Œæ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•ã€‚

ğŸ”–

ç®€æ´åœ°è¡¨è¾¾è¡Œä¸ºå‚æ•°åŒ–



### 1.2 Javaæ€ä¹ˆè¿˜åœ¨å˜

å¯åœ¨ç°å®ä¸­ï¼Œ**æŸäº›è¯­è¨€åªæ˜¯æ›´é€‚åˆæŸäº›æ–¹é¢**ã€‚æ¯”å¦‚ï¼ŒCå’ŒC++ä»ç„¶æ˜¯æ„å»ºæ“ä½œç³»ç»Ÿå’Œå„ç§åµŒå…¥å¼ç³»ç»Ÿçš„æµè¡Œå·¥å…·ï¼Œå› ä¸ºå®ƒä»¬ç¼–å†™å‡ºçš„ç¨‹åºå°½ç®¡å®‰å…¨æ€§ä¸ä½³ï¼Œä½†è¿è¡Œæ—¶å ç”¨èµ„æºå°‘ã€‚

#### Javaåœ¨ç¼–ç¨‹è¯­è¨€ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä½ç½®

åœ¨ç¡¬ä»¶æ— å…³çš„å†…å­˜æ¨¡å‹ä¸­ï¼Œå¹¶å‘çº¿ç¨‹åœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šå‘ç”Ÿæ„å¤–çš„æ¦‚ç‡æ¯”å•æ ¸å¤„ç†å™¨ä¸Šå¤§å¾—å¤š

Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰åŠå…¶å­—èŠ‚ç å¯èƒ½ä¼šå˜å¾—æ¯”Javaè¯­è¨€æœ¬èº«æ›´é‡è¦



#### æµå¤„ç†

æµæ˜¯ä¸€ç³»åˆ—æ•°æ®é¡¹ï¼Œä¸€æ¬¡åªç”Ÿæˆä¸€é¡¹ã€‚ç¨‹åºå¯ä»¥ä»è¾“å…¥æµä¸­ä¸€ä¸ªä¸€ä¸ªè¯»å–æ•°æ®é¡¹ï¼Œç„¶åä»¥åŒæ ·çš„æ–¹å¼å°†æ•°æ®é¡¹å†™å…¥è¾“å‡ºæµã€‚ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºæµå¾ˆå¯èƒ½æ˜¯å¦ä¸€ä¸ªç¨‹åºçš„è¾“å…¥æµã€‚



Java 8å¯ä»¥é€æ˜åœ°æŠŠè¾“å…¥çš„ä¸ç›¸å…³éƒ¨åˆ†æ‹¿åˆ°å‡ ä¸ªCPUæ ¸ä¸Šå»åˆ†åˆ«æ‰§è¡Œä½ çš„Streamæ“ä½œæµæ°´çº¿â€”â€”è¿™æ˜¯å‡ ä¹å…è´¹çš„å¹¶è¡Œï¼Œç”¨ä¸ç€å»è´¹åŠ²æThreadäº†ã€‚



#### ç”¨è¡Œä¸ºå‚æ•°åŒ–æŠŠä»£ç ä¼ é€’ç»™æ–¹æ³•

Java 8ä¸­å¢åŠ çš„å¦ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µæ˜¯**é€šè¿‡APIæ¥==ä¼ é€’ä»£ç ==çš„èƒ½åŠ›**ã€‚



#### å¹¶è¡Œä¸å…±äº«çš„å¯å˜æ•°æ®

æ²¡æœ‰å…±äº«çš„å¯å˜æ•°æ®ï¼Œä»¥åŠå°†æ–¹æ³•å’Œå‡½æ•°ï¼ˆå³ä»£ç ï¼‰ä¼ é€’ç»™å…¶ä»–æ–¹æ³•çš„èƒ½åŠ›ï¼Œè¿™ä¸¤ä¸ªè¦ç‚¹æ˜¯å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼çš„åŸºçŸ³ã€‚



#### Javaéœ€è¦æ¼”å˜

è¯­è¨€éœ€è¦ä¸æ–­æ”¹è¿›ï¼Œä»¥é€‚åº”ç¡¬ä»¶çš„æ›´æ–°æˆ–æ»¡è¶³ç¨‹åºå‘˜çš„æœŸå¾…ã€‚



### 1.3 Javaä¸­çš„å‡½æ•°



#### æ–¹æ³•å’ŒLambdaä½œä¸ºä¸€ç­‰å€¼

æ–¹æ³•å¼•ç”¨



> ä»€ä¹ˆæ˜¯è°“è¯ï¼Ÿ
>
> è°“è¯ï¼ˆpredicateï¼‰åœ¨æ•°å­¦ä¸Šå¸¸å¸¸ç”¨æ¥ä»£è¡¨ç±»ä¼¼äºå‡½æ•°çš„ä¸œè¥¿ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°å€¼ï¼Œå¹¶è¿”å›trueæˆ–falseã€‚



#### ä»ä¼ é€’æ–¹æ³•åˆ°Lambda



### 1.4 æµ

å‡ ä¹æ¯ä¸ªJavaåº”ç”¨éƒ½ä¼š**åˆ¶é€ å’Œå¤„ç†é›†åˆ**ã€‚ä½†é›†åˆç”¨èµ·æ¥å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆç†æƒ³ã€‚æ¯”æ–¹è¯´ï¼Œä½ éœ€è¦ä»ä¸€ä¸ªåˆ—è¡¨ä¸­ç­›é€‰é‡‘é¢è¾ƒé«˜çš„äº¤æ˜“ï¼Œç„¶åæŒ‰è´§å¸åˆ†ç»„ã€‚ä½ éœ€è¦å†™ä¸€å¤§å †æ¨¡æ¿ä»£ç æ¥å®ç°è¿™ä¸ªæ•°æ®å¤„ç†å‘½ä»¤ï¼š

![](images/image-20230607223259383.png)

Stream APIçš„æ–¹å¼ï¼š

![](images/image-20230607223351705.png)

Stream APIå¤„ç†æ•°æ®çš„æ–¹å¼ä¸Collection APIä¸åŒã€‚ç”¨é›†åˆçš„è¯ï¼Œä½ å¾—è‡ªå·±ç®¡ç†è¿­ä»£è¿‡ç¨‹ã€‚ä½ å¾—ç”¨for-eachå¾ªç¯ä¸€ä¸ªä¸ªåœ°è¿­ä»£å…ƒç´ ï¼Œç„¶åå†å¤„ç†å…ƒç´ ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ•°æ®è¿­ä»£æ–¹æ³•ç§°ä¸º==å¤–éƒ¨è¿­ä»£==ã€‚ç›¸åï¼Œæœ‰äº†Stream APIï¼Œä½ æ ¹æœ¬ç”¨ä¸ç€æ“å¿ƒå¾ªç¯çš„äº‹æƒ…ã€‚æ•°æ®å¤„ç†å®Œå…¨æ˜¯åœ¨åº“å†…éƒ¨è¿›è¡Œçš„ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ€æƒ³å«ä½œ==å†…éƒ¨è¿­ä»£==ã€‚



ğŸ”–



Collectionä¸»è¦æ˜¯ä¸ºäº†==å­˜å‚¨å’Œè®¿é—®æ•°æ®==ï¼ŒStreamåˆ™ä¸»è¦ç”¨äº==æè¿°å¯¹æ•°æ®çš„è®¡ç®—==ã€‚

Stream API**å…è®¸å¹¶æå€¡å¹¶è¡Œå¤„ç†**ä¸€ä¸ªStreamä¸­çš„å…ƒç´ ã€‚



### 1.5 é»˜è®¤æ–¹æ³•åŠJavaæ¨¡å—



### 1.6 æ¥è‡ªå‡½æ•°å¼ç¼–ç¨‹çš„å…¶ä»–å¥½æ€æƒ³

å°†æ–¹æ³•å’ŒLambdaä½œä¸ºä¸€ç­‰å€¼ï¼Œä»¥åŠåœ¨æ²¡æœ‰å¯å˜å…±äº«çŠ¶æ€æ—¶ï¼Œå‡½æ•°æˆ–æ–¹æ³•å¯ä»¥æœ‰æ•ˆã€å®‰å…¨åœ°å¹¶è¡Œæ‰§è¡Œã€‚

é€šè¿‡æ˜¾å¼ä½¿ç”¨æ›´å¤šçš„æè¿°æ€§æ•°æ®ç±»å‹æ¥é¿å…nullã€‚ `Optional<T>`

ï¼ˆç»“æ„åŒ–çš„ï¼‰æ¨¡å¼åŒ¹é…ã€‚

ğŸ”–



## 2 é€šè¿‡è¡Œä¸ºå‚æ•°åŒ–ä¼ é€’ä»£ç 

è½¯ä»¶å·¥ç¨‹ä¸­ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜å°±æ˜¯ï¼Œ**==ä¸ç®¡ä½ åšä»€ä¹ˆï¼Œç”¨æˆ·çš„éœ€æ±‚è‚¯å®šä¼šå˜==**ã€‚

==è¡Œä¸ºå‚æ•°åŒ–==å°±æ˜¯å¯ä»¥å¸®åŠ©ä½ **å¤„ç†é¢‘ç¹å˜æ›´çš„éœ€æ±‚çš„ä¸€ç§è½¯ä»¶å¼€å‘æ¨¡å¼**ã€‚æ„å‘³ç€æ‹¿å‡ºä¸€ä¸ªä»£ç å—ï¼ŒæŠŠå®ƒå‡†å¤‡å¥½å´ä¸å»æ‰§è¡Œå®ƒã€‚è¿™ä¸ªä»£ç å—ä»¥åå¯ä»¥è¢«ä½ ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†è°ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥==æ¨è¿Ÿ==è¿™å—ä»£ç çš„æ‰§è¡Œã€‚

ğŸ”–

### 2.1 åº”å¯¹ä¸æ–­å˜åŒ–çš„éœ€æ±‚

#### åˆè¯•ç‰›åˆ€ï¼šç­›é€‰ç»¿è‹¹æœ

```java
        enum Color { RED, GREEN }
```

![](images/image-20230608073127173.png)

æ­¤æ—¶ï¼Œå¦‚æœç­›é€‰å…¶ä»–é¢œè‰²è‹¹æœå°±è¦ç¼–å†™ç±»ä¼¼çš„å¦ä¸€ä¸ªæ–¹æ³•ã€‚

> ä¸€ä¸ªå¥½çš„åŸåˆ™æ˜¯ç¼–å†™ç±»ä¼¼çš„ä»£ç ä¹‹åï¼Œå°½é‡å¯¹å…¶è¿›è¡ŒæŠ½è±¡åŒ–ã€‚

#### å†å±•èº«æ‰‹ï¼šæŠŠé¢œè‰²ä½œä¸ºå‚æ•°

```java
public static List<Apple> filterApplesByColor(List<Apple> inventory,
                                              Color color) {
  List<Apple> result = new ArrayList<>();
  for (Apple apple: inventory) {
    if ( apple.getColor().equals(color) ) {
      result.add(apple);
    }
  }
  return result;
}
```

å¦‚æœè¦åšé‡é‡çš„ç­›é€‰ï¼Œå°±ç¼–å†™å¦å¤–ä¸€ä¸ªç±»ä¼¼æ–¹æ³•ï¼š

```java
public static List<Apple> filterApplesByWeight(List<Apple> inventory,
                                               int weight) {
  List<Apple> result = new ArrayList<>();
  For (Apple apple: inventory){
    if ( apple.getWeight() > weight ) {
      result.add(apple);
    }
  }
  return result;
}
```



#### ç¬¬ä¸‰æ¬¡å°è¯•ï¼šå¯¹ä½ èƒ½æƒ³åˆ°çš„æ¯ä¸ªå±æ€§åšç­›é€‰

![](images/image-20230608073617491.png)

```java
List<Apple> greenApples = filterApples(inventory, GREEN, 0, true);
List<Apple> heavyApples = filterApples(inventory, null, 150, false);
...
```

è¿™ä¸ªè§£å†³æ–¹æ¡ˆè¿˜æ˜¯ä¸èƒ½å¾ˆå¥½åœ°åº”å¯¹å˜åŒ–çš„éœ€æ±‚ã€‚

å®¢æˆ·ç«¯ä»£ç çœ‹ä¸Šå»ç³Ÿé€äº†ã€‚trueå’Œfalseæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

å¦‚æœè¦æ±‚å¯¹è‹¹æœçš„ä¸åŒå±æ€§åšç­›é€‰ï¼Œæ¯”å¦‚å¤§å°ã€å½¢çŠ¶ã€äº§åœ°ç­‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

å¦‚æœè¦æ±‚ç»„åˆå±æ€§ï¼Œåšæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ç»¿è‰²çš„é‡è‹¹æœï¼Œåˆè¯¥æ€ä¹ˆåŠï¼Ÿ

### 2.2 è¡Œä¸ºå‚æ•°åŒ–

æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡

ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯==å¯¹é€‰æ‹©æ ‡å‡†å»ºæ¨¡==ï¼šä½ è€ƒè™‘çš„æ˜¯è‹¹æœï¼Œéœ€è¦æ ¹æ®Appleçš„æŸäº›å±æ€§ï¼ˆæ¯”å¦‚å®ƒæ˜¯ç»¿è‰²çš„å—ï¼Ÿé‡é‡è¶…è¿‡150å…‹å—ï¼Ÿï¼‰æ¥è¿”å›ä¸€ä¸ªbooleanå€¼ã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä¸º==è°“è¯==ï¼ˆå³ä¸€ä¸ªè¿”å›booleanå€¼çš„å‡½æ•°ï¼‰ã€‚å®šä¹‰ä¸€ä¸ªæ¥å£æ¥å¯¹é€‰æ‹©æ ‡å‡†å»ºæ¨¡ï¼š

```java
public interface ApplePredicate {
  boolean test(Apple apple);
}
```

ç„¶åä¸åŒçš„é€‰æ‹©ç­–ç•¥å°±å¯ä»¥åœ¨é€šè¿‡å®ç°è¿™ä¸ªæ¥å£çš„ç±»ä¸­å®ç°ã€‚

![](images/image-20230608074753086.png)

ç»™filterApplesæ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œè®©å®ƒæ¥å—ApplePredicateå¯¹è±¡ã€‚è¿™åœ¨è½¯ä»¶å·¥ç¨‹ä¸Šæœ‰å¾ˆå¤§å¥½å¤„ï¼šæŠŠfilterApplesæ–¹æ³•è¿­ä»£é›†åˆçš„==é€»è¾‘==ä¸è¦åº”ç”¨åˆ°é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„==è¡Œä¸º==ï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ªè°“è¯ï¼‰åŒºåˆ†å¼€äº†ã€‚

#### ç¬¬å››æ¬¡å°è¯•ï¼šæ ¹æ®æŠ½è±¡æ¡ä»¶ç­›é€‰

![](images/image-20230608075647943.png)

#### 1ï¼ä¼ é€’ä»£ç /è¡Œä¸º

ç°åœ¨ä»»ä½•é€‰æ‹©ç­–ç•¥ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç°ApplePredicateå°±è¡Œäº†ã€‚

```java
// æ‰¾å‡ºæ‰€æœ‰é‡é‡è¶…è¿‡150å…‹çš„çº¢è‹¹æœ
public class AppleRedAndHeavyPredicate implements ApplePredicate {
  public boolean test(Apple apple){
    return RED.equals(apple.getColor()) && apple.getWeight() > 150;
  }
}


List<Apple> redAndHeavyApples = filterApples(inventory, new AppleRedAndHeavyPredicate());
```

filterApplesæ–¹æ³•çš„è¡Œä¸ºå–å†³äºé€šè¿‡ApplePredicateå¯¹è±¡ä¼ é€’çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**æŠŠfilterApplesæ–¹æ³•çš„è¡Œä¸ºå‚æ•°åŒ–äº†**ã€‚

è¿˜å¯ä»¥è¿›ä¸€æ­¥é€šè¿‡Lambdaè¡¨è¾¾å¼ï¼Œæ¥ç®€åŒ–ï¼Œæ— é¡»å®šä¹‰å¤šä¸ªApplePredicateç±»ã€‚

![](images/image-20230608080905421.png)

#### 2ï¼å¤šç§è¡Œä¸ºï¼Œä¸€ä¸ªå‚æ•°

![](images/image-20230608082739724.png)

### 2.3 å¯¹ä»˜å•°å”†

ä½¿ç”¨è°“è¯ç­›é€‰æ—¶ï¼Œå£°æ˜å¥½å‡ ä¸ªå®ç°ApplePredicateæ¥å£çš„ç±»æ˜¯æ¯”è¾ƒå•°å—¦çš„ï¼š

![](images/image-20230608083808143.png)

Javaæœ‰ä¸€ä¸ªæœºåˆ¶ç§°ä¸º==åŒ¿åç±»==ï¼Œå®ƒå¯ä»¥è®©ä½ **åŒæ—¶å£°æ˜å’Œå®ä¾‹åŒ–ä¸€ä¸ªç±»**ã€‚

#### ç¬¬äº”æ¬¡å°è¯•ï¼šä½¿ç”¨åŒ¿åç±»

![](images/image-20230608084129667.png)

GUIåº”ç”¨ç¨‹åºä¸­ç»å¸¸ä½¿ç”¨åŒ¿åç±»æ¥åˆ›å»ºäº‹ä»¶å¤„ç†å™¨å¯¹è±¡ï¼š

![](images/image-20230608084156584.png)

#### ç¬¬å…­æ¬¡å°è¯•ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼

```java
List<Apple> result = filterApples(inventory, (Apple apple) -> RED.equals(apple.getColor()));
```

![](images/image-20230608084758441.png)

#### ç¬¬ä¸ƒæ¬¡å°è¯•ï¼šå°†Listç±»å‹æŠ½è±¡åŒ–

ç›®å‰ï¼ŒfilterApplesæ–¹æ³•è¿˜åªé€‚ç”¨äºAppleã€‚è¿˜å¯ä»¥å°†Listç±»å‹æŠ½è±¡åŒ–ï¼š

```java
public static <T> List<T> filter2(List<T> list, Predicate<T> p) {
  List<T> result = new ArrayList<>();
  for (T e : list) {
    if (p.test(e)) {
      result.add(e);
    }
  }
  return result;
}

interface Predicate<T> {
  boolean test(T t);
}
```

å¯ä»¥æŠŠfilter2æ–¹æ³•ç”¨åœ¨é¦™è•‰ã€æ©˜å­ã€Integeræˆ–æ˜¯Stringç­‰çš„åˆ—è¡¨ä¸Šï¼š

```java
List<Apple> redApples = filter2(inventory, (Apple a) -> Color.RED.equals(a.getColor()));
List<Integer> evenNumbers = filter2(Arrays.asList(1, 10, 4, 3), (Integer i) -> i % 2 == 0);
```

